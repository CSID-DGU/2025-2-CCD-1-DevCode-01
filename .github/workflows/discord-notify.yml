name: Discord Notify

on:
  pull_request_target:
    types: [opened, reopened, synchronize, closed]
    paths:
      - "FE/**"
      - "BE/**"

permissions:
  contents: read
  pull-requests: read

concurrency:
  group: discord-${{ github.event.pull_request.number || github.run_id }}
  cancel-in-progress: true

jobs:
  filter:
    runs-on: ubuntu-latest
    outputs:
      fe: ${{ steps.filter.outputs.fe }}
      be: ${{ steps.filter.outputs.be }}
    steps:
      - id: filter
        uses: dorny/paths-filter@v3
        with:
          filters: |
            fe:
              - 'FE/**'
            be:
              - 'BE/**'

  notify-fe:
    needs: filter
    if: ${{ needs.filter.outputs.fe == 'true' }}
    runs-on: ubuntu-latest
    steps:
      - name: FE PR Open/Update
        if: ${{ github.event.action != 'closed' }}
        uses: tsickert/discord-webhook@v7.0.0
        with:
          webhook-url: ${{ secrets.Discord_FE }}
          content: >
            📂 FE PR 올라옴!
            #${{ github.event.pull_request.number }} ${{ github.event.pull_request.title }}
            🔗 ${{ github.event.pull_request.html_url }}

      - name: FE PR Merged
        if: ${{ github.event.action == 'closed' && github.event.pull_request.merged == true }}
        uses: tsickert/discord-webhook@v7.0.0
        with:
          webhook-url: ${{ secrets.Discord_FE }}
          content: >
            ✅ FE PR 머지 완료!
            #${{ github.event.pull_request.number }}
            🔗 ${{ github.event.pull_request.html_url }}

  notify-be:
    needs: filter
    if: ${{ needs.filter.outputs.be == 'true' }}
    runs-on: ubuntu-latest
    steps:
      - name: BE PR Open/Update
        if: ${{ github.event.action != 'closed' }}
        uses: tsickert/discord-webhook@v7.0.0
        with:
          webhook-url: ${{ secrets.Discord_BE }}
          content: >
            📂 BE PR 올라옴!
            #${{ github.event.pull_request.number }} ${{ github.event.pull_request.title }}
            🔗 ${{ github.event.pull_request.html_url }}

      - name: BE PR Merged
        if: ${{ github.event.action == 'closed' && github.event.pull_request.merged == true }}
        uses: tsickert/discord-webhook@v7.0.0
        with:
          webhook-url: ${{ secrets.Discord_BE }}
          content: >
            ✅ BE PR 머지 완료!
            #${{ github.event.pull_request.number }}
            🔗 ${{ github.event.pull_request.html_url }}
