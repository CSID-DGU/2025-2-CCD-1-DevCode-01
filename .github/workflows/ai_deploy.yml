name: Deploy AI Server to EC2

on:
  push:
    branches: ["main"]
    paths:
      - "AI/**"    

jobs:
  deploy:
    runs-on: ubuntu-latest

    steps:
    - name: Deploy to EC2 via SSH
      uses: appleboy/ssh-action@v1.2.0
      with:
        host: ${{ secrets.AI_EC2_HOST }}
        username: ubuntu
        key: ${{ secrets.AI_EC2_KEY }}
        script: |
          echo "ğŸ“Œ AI ì„œë²„ ë°°í¬ ì‹œì‘"

          cd /home/ubuntu/2025-2-CCD-1-DevCode-01/AI

          echo "ğŸ“Œ ìµœì‹  ì½”ë“œ ê°€ì ¸ì˜¤ëŠ” ì¤‘..."
          git pull origin main

          echo "ğŸ“Œ ê°€ìƒí™˜ê²½ í™œì„±í™”..."
          source venv/bin/activate

          echo "ğŸ“Œ AI ì„œë²„ systemd ì¬ì‹œì‘..."
          sudo systemctl restart ai-api
          sudo systemctl restart ai-celery
          sudo systemctl restart exam-celery
          sudo systemctl restart nginx

          echo "âœ… AI ì„œë²„ ë°°í¬ ì™„ë£Œ!"
